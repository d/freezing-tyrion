def num_dot_dot: (split("..") | length - 1); def relative_include_to_abs($dir): num_dot_dot as $num_dot_dot | ($dir | split("/") | .[0: -$num_dot_dot] | join("/")) + "/" + (split("../") | last); map(if (.file | endswith(".cpp")) then . + (. as {directory: $dir, file: $file} | (if .file | startswith("/") then .file else .directory + "/" + .file end) as $abs_file | {"arguments": .arguments | map( if startswith("-I") and num_dot_dot > 0 then "-I" + relative_include_to_abs($dir) elif . == $file then $abs_file else . end), "directory": .directory | split("/src/backend") | first, file: $abs_file}) else . end)
